# -*- mode: Python -*-

def onewatch():
  yaml = read_file('deployment.yaml')
  image_name = 'gcr.io/windmill-test-containers/integration/onewatch'
  start_fast_build('Dockerfile', image_name, '/go/bin/onewatch')
  repo = local_git_repo('../../')
  path = repo.path('integration/onewatch')
  add(path, '/go/src/github.com/windmilleng/tilt/integration/onewatch')
  run('go install github.com/windmilleng/tilt/integration/onewatch')
  image = stop_build()
  return k8s_service(yaml, image)
