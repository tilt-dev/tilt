# keep image in sync with .circleci/config.yml
image: gcr.io/windmill-public-containers/tilt-releaser@sha256:c0772f4d131b1370b4d05071e0589ede17da48d6c339215095b2afc7a7ea6951
location: /go/src/github.com/tilt-dev/tilt
command_prefix: set -euo pipefail
tasks:
  build-js:
    command: make build-js
    input_paths:
      - pkg/assets/build
      - web/
      - Makefile
    excluded_input_paths:
      - web/build
      - web/node_modules

  build:
    dependencies:
      - build-js
    command: goreleaser build --snapshot --rm-dist
    input_paths:
      - .git/
      - cmd/
      - internal/
      - pkg/
      - vendor/
      - .goreleaser.yml
      - go.mod
      - go.sum
      - Makefile
    excluded_input_paths:
      - pkg/assets/build
    output_paths:
      - dist/
